(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{24:function(e,t,n){e.exports=n(59)},29:function(e,t,n){},37:function(e,t,n){},39:function(e,t,n){},41:function(e,t,n){},43:function(e,t,n){},45:function(e,t,n){},47:function(e,t,n){},49:function(e,t,n){},51:function(e,t,n){},53:function(e,t,n){},55:function(e,t,n){},57:function(e,t,n){},59:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(19),c=n.n(o),s=(n(29),n(1)),i=n(2),u=n(4),l=n(3),m=n(5),p=n(8),d=n(11),f=n.n(d),E=n(13),O=function(){var e=Object(E.a)(f.a.mark(function e(t,n){var r,a;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://auth.lasfu.roro3.com/login",{method:"POST",headers:{Authorization:"Basic bG9uZ3Rlcm1fY2xpZW50OmFjbWVzZWNyZXQ=","Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})});case 2:return r=e.sent,e.next=5,r.json();case 5:return a=e.sent,e.abrupt("return",a.tokens);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),h={type:"LOGIN_REQUESTING"},b=function(e){return{type:"LOGIN_SUCCESS ",accessToken:e}},g={type:"LOGIN_FAILED"},v={type:"LOGOUT"},C=function(){return function(e){localStorage.removeItem("accessToken"),e(v)}},T=n(20),y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D;return function(n){return n(function(e,t){return{type:"TO_SUBSCRIBE_TOPIC",topic:e,handler:t}}(e,t))}},j=function(e){return function(t){return t(function(e){return{type:"TO_UNSUBSCRIBE_TOPIC",topicUri:e}}(e))}},S=function(e,t){return function(n){return n(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:"TO_PUBLISH",data:{destination:e,body:JSON.stringify(t)}}}(e,t))}},R=function(e){return{type:"TOPIC_SUBSCRIBED",topic:e}},N=function(e){return{type:"TOPIC_UNSUBSCRIBED",topic:e}},_={type:"ENTERING_ROOM"},I={type:"EXITING_ROOM"},k=function(e){return function(t){t(function(e){return{type:"SELECTED_USER",attendee:e}}(e))}},L={ALL_ROOMS_FETCHED:function(e){return{type:"ALL_ROOMS_FETCHED",rooms:e.rooms}},CHAT_MESSAGE:function(e){return function(t){t({type:"CHAT_MESSAGE",message:e.message})}},ROOM_CREATED:function(e){return{type:"ROOM_CREATED",room:e.room}},ROOM_DETAILS_FETCHED:function(e){return function(t){t({type:"ROOM_DETAILS_FETCHED",room:e.room}),t(S("/app/room.".concat(e.room.id,".enter"),{}))}},USER_ENTERED:function(e){return{type:"USER_ENTERED",attendee:e.attendee}},USER_EXITED:function(e){return t=e.roomId,e.attendee,{type:"USER_EXITED",attendee:t};var t},USER_CONNECTED:function(e){return function(e){e(B())}}},D=function(e,t){console.log(t.body);var n=JSON.parse(t.body);e(L[n.type](n))},M={type:"STOMP_CLIENT_CONNECT_FAILED"},U={type:"STOMP_CLIENT_DISCONNECTED",stompClient:null},w={type:"STOMP_CLIENT_WILL_DISCONNECT"},x="STOMP_CLIENT_TO_DISCONNECT",A={type:x},B=function(){return function(e){e(w),e(A)}},P=n(7),W=(n(37),function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"lds-ring"},a.a.createElement("div",null),a.a.createElement("div",null),a.a.createElement("div",null),a.a.createElement("div",null))}}]),t}(r.Component)),G=(n(39),function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).state={email:"",password:""},n.editText=function(e){n.setState(Object(p.a)({},e.target.name,e.target.value))},n.isLoggedIn=function(){var e=n.props.accessToken;return e&&e.length>0},n.logout=function(){var e=n.props,t=e.stompClient,r=e.disconnectWS,a=e.logout;null!==t&&r(t),a()},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isLoading,n=e.login,r=this.state,o=r.email,c=r.password;return a.a.createElement("div",{className:"login"},t&&a.a.createElement(W,null),!this.isLoggedIn()&&a.a.createElement("div",null,a.a.createElement("input",{type:"text",name:"email",onChange:this.editText,placeholder:"user@example.com",value:o}),a.a.createElement("input",{type:"password",name:"password",onChange:this.editText,placeholder:"Enter password"}),a.a.createElement("button",{onClick:function(){return n(o,c)}},"Login")),this.isLoggedIn()&&a.a.createElement("div",null,a.a.createElement("button",{onClick:this.logout},"Logout")))}}]),t}(r.Component)),H=Object(P.b)(function(e){return{stompClient:e.stompReducer.stompClient,isLoading:e.authReducer.isLoading,accessToken:e.authReducer.accessToken}},function(e){return{disconnectWS:function(e){return B(e)},login:function(t,n){return e(function(e,t){return function(){var n=Object(E.a)(f.a.mark(function n(r){var a,o;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r(h),n.prev=1,n.next=4,O(e,t);case 4:a=n.sent,o=a.accessToken,(c=o)&&c.length>0&&localStorage.setItem("accessToken",c),r(b(o)),n.next=14;break;case 10:n.prev=10,n.t0=n.catch(1),console.error(n.t0),r(g);case 14:case"end":return n.stop()}var c},n,this,[[1,10]])}));return function(e){return n.apply(this,arguments)}}()}(t,n))},logout:function(){return e(C())}}})(G),F=(n(41),function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).state={displayName:""},n.isLoggedIn=function(){var e=n.props.accessToken;return e&&e.length>0},n.editText=function(e){n.setState(Object(p.a)({},e.target.name,e.target.value))},n.disconnectWS=function(e){console.log("CLICK"),n.props.disconnectWS()},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.connectWS,n=e.accessToken,r=e.isConnected,o=this.state.displayName;return a.a.createElement("div",{className:"entrance"},a.a.createElement("input",{type:"text",name:"displayName",value:this.state.displayName,onChange:this.editText,disabled:!this.isLoggedIn()||r,placeholder:"Nick name"}),!r&&a.a.createElement("button",{disabled:!this.isLoggedIn()||""===this.state.displayName,onClick:function(){return t(n,o)}},"Start Chatting"),r&&a.a.createElement("button",{onClick:this.disconnectWS},"Leave"))}}]),t}(r.Component)),X=Object(P.b)(function(e){return{isConnected:e.stompReducer.isConnected,accessToken:e.authReducer.accessToken,stompClient:e.stompReducer.stompClient}},function(e){return{connectWS:function(t,n){return e(function(e,t){return function(n){var r=new T.Client({brokerURL:"ws://devserver.my:8080/wsdemo",connectHeaders:{displayName:t,accessToken:e},debug:function(e){console.log(e)},reconnectDelay:0,heartbeatIncoming:4e3,heartbeatOutgoing:4e3});r.onConnect=function(e){var t;console.log(e),n((t=e.headers["user-name"],function(e){e(function(e){return{type:"FETCHED_ME",me:e}}(t))})),n(function(e){return{type:"STOMP_CLIENT_CONNECTED",stompClient:e}}(r))},r.onDisconnect=function(e){n(U)},r.onError=function(e){console.log("Broker reported error: ".concat(e.headers.message)),console.log("Additional details: ".concat(e.body)),n(M)},r.activate()}}(t,n))},disconnectWS:function(){return e(B())}}})(F),J=(n(43),n(45),function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).state={isSelected:!1},n.select=function(e){n.setState({isSelected:!0})},n.unselect=function(e){n.setState({isSelected:!1})},n.enterRoom=function(){console.log("CLICKED"),n.props.enterRoom(n.props.room)},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.room;return a.a.createElement("div",{className:"room-card",onMouseOver:this.select,onMouseOut:this.unselect},a.a.createElement("h3",null,e.name),a.a.createElement("div",null,a.a.createElement("span",{className:"caption"},"Current: "),a.a.createElement("span",null,e.totalAttendees," attendees.")),a.a.createElement("button",{className:this.state.isSelected?"hovering":"",onClick:this.enterRoom},"Enter"))}}]),t}(r.Component)),Z=Object(P.b)(null,function(e){return{enterRoom:function(t){return e(function(e){return function(t){t(_),t(y({uri:"/topic/room.".concat(e.id)},D)),t(S("/app/room.".concat(e.id,".details"),{}))}}(t))}}})(J),Q=function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).state={name:""},n.editText=function(e){n.setState(Object(p.a)({},e.target.name,e.target.value))},n.createRoom=function(e){var t=n.props.stompClient,r=n.state.name;t.publish({destination:"/app/room.create",body:JSON.stringify({name:r})}),n.setState({name:""})},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.rooms;return console.log(e),a.a.createElement("div",null,a.a.createElement("h2",null,"Rooms"),a.a.createElement("div",null,a.a.createElement("div",null,"Create a room"),a.a.createElement("input",{type:"text",name:"name",onChange:this.editText,value:this.state.name}),a.a.createElement("button",{onClick:this.createRoom,disabled:""===this.state.name},"Create")),0===e.length&&a.a.createElement("p",null,"No body is chatting now."),a.a.createElement("div",{className:"room-list"},e.length>0&&e.map(function(e){return a.a.createElement(Z,{key:e.id,room:e})})))}}]),t}(r.Component),z=Object(P.b)(function(e){return{rooms:e.chatReducer.rooms,stompClient:e.stompReducer.stompClient}})(Q),K=(n(47),function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).selectUser=function(e){var t=n.props,r=t.attendee,a=t.selectUser;r!==t.speakingTo&&a(r)},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.attendee,n=t===e.speakingTo?" selected":"";return a.a.createElement("div",{className:"user-card"+n,onClick:this.selectUser},a.a.createElement("span",null,t.displayName))}}]),t}(r.Component)),q=Object(P.b)(function(e){return{speakingTo:e.chatReducer.speakingTo}},function(e){return{selectUser:function(t){return e(k(t))}}})(K),V=(n(49),function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.message,n=e.me,r=t.from.user.id===n?" self":" peer";return a.a.createElement("div",{className:"message"+r},a.a.createElement("span",null,t.from.displayName," says "),a.a.createElement("span",null,t.timeStamp),a.a.createElement("p",null,t.content))}}]),t}(r.Component)),Y=Object(P.b)(function(e){return{me:e.chatReducer.me}})(V),$=(n(51),function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).state={message:""},n.exitRoom=function(){var e=n.props;(0,e.exitRoom)(e.room)},n.unselectUser=function(e){var t=n.props,r=t.speakingTo,a=t.selectUser;null!==r&&a(null)},n.editText=function(e){n.setState(Object(p.a)({},e.target.name,e.target.value))},n.sendMessage=function(e){var t=n.props,r=t.publish,a=t.speakingTo,o=t.room,c=n.state.message;r(null===a?"/app/room.".concat(o.id,".message"):"/app/user.".concat(a.sessionId,".message"),{message:c}),n.setState({message:""})},n}return Object(m.a)(t,e),Object(i.a)(t,[{key:"ComponentDidMount",value:function(){var e=this.props,t=e.room;(0,e.subscribe)("/app/".concat(t.id,"/enter"))}},{key:"render",value:function(){var e=this.props,t=e.room,n=e.me,r=e.speakingTo,o=e.roomMessages,c=e.userMessages,s=null===r?o[t.id]:c[r.user.id],i=t.attendees;return a.a.createElement("div",{className:"room"},a.a.createElement("div",{className:"room-control"},a.a.createElement("span",{className:"room-caption"},"Room: ",t.name),a.a.createElement("button",{onClick:this.exitRoom},"Exit")),a.a.createElement("div",{className:"room-pane"},a.a.createElement("div",{className:"user-pane"},a.a.createElement("h4",{className:"centered"},"Users"),a.a.createElement("div",{className:"user-public",onClick:this.unselectUser},a.a.createElement("span",null,"public")),i.length>0&&i.filter(function(e){return e.user.id!==n}).map(function(e){return a.a.createElement(q,{attendee:e,key:e.user.id})})),a.a.createElement("div",{className:"message-pane"},a.a.createElement("h4",{className:"centered"},"messages"),a.a.createElement("div",{className:"message-display"},s&&s.length>0?s.map(function(e){return a.a.createElement(Y,{message:e,key:e.timeStamp})}):a.a.createElement("span",null,"No messages for now.")),a.a.createElement("div",{className:"message-enter"},a.a.createElement("span",null,"Speaking to: "),a.a.createElement("span",null,null===r?"public":r.displayName),a.a.createElement("br",null),a.a.createElement("input",{className:"message-input",name:"message",value:this.state.message,type:"text",onChange:this.editText,placeholder:"Input message"}),a.a.createElement("button",{onClick:this.sendMessage},"Send")))))}}]),t}(r.Component)),ee=Object(P.b)(function(e){return{me:e.chatReducer.me,speakingTo:e.chatReducer.speakingTo,room:e.chatReducer.currentRoom,roomMessages:e.chatReducer.roomMessages,userMessages:e.chatReducer.userMessages,stompClient:e.stompReducer.stompClient}},function(e){return{exitRoom:function(t){return e(function(e){return function(t){t(I),t(S("/app/room.".concat(e.id,".exit"),{})),t(j("/topic/room.".concat(e.id))),t(function(e){return{type:"EXITED_ROOM",room:e}}(e)),t(S("/app/room.showall"))}}(t))},subscribe:function(t){return e(y(t))},unsubscribe:function(t){return e(j(t))},publish:function(t,n){return e(S(t,n))},selectUser:function(t){return e(k(t))}}})($),te=(n(53),function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.subscribe,n=e.publish;t({uri:"/user/queue/events"}),t({uri:"/topic/events"}),n("/app/room.showall")}},{key:"render",value:function(){var e=this.props.currentRoom;return a.a.createElement("div",{className:"chat-area"},null===e?a.a.createElement("div",{className:"room-pane"},a.a.createElement(z,null)):a.a.createElement("div",{className:"dialog-pane"},a.a.createElement(ee,null)))}}]),t}(r.Component)),ne=Object(P.b)(function(e){return{currentRoom:e.chatReducer.currentRoom,isConnected:e.stompReducer.isConnected}},function(e){return{subscribe:function(t){return e(y(t))},publish:function(t,n){return e(S(t,n))}}})(te),re=(n(55),function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.isConnected;return a.a.createElement("div",{className:"chat"},a.a.createElement("h1",null,"Websocket Chat Demo"),a.a.createElement("div",{className:"identity-area"},a.a.createElement("div",{className:"entrance-pane"},a.a.createElement(X,null)),a.a.createElement("div",{className:"login-pane"},a.a.createElement(H,null))),e&&a.a.createElement(ne,null))}}]),t}(r.Component)),ae=Object(P.b)(function(e){return{stompClient:e.stompReducer.stompClient,isConnected:e.stompReducer.isConnected}})(re),oe=n(9),ce=n(6),se={isLoading:!1,accessToken:localStorage.getItem("accessToken")},ie={stompClient:null,isConnected:!1},ue={currentRoom:null,me:null,rooms:[],speakingTo:null,topics:[],userMessages:{},roomMessages:{}},le=Object(oe.combineReducers)({authReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=arguments.length>1?arguments[1]:void 0,n=t.type;return"LOGIN_REQUESTING"===n?Object(ce.a)({},e,{isLoading:!0}):"LOGIN_SUCCESS "===n?Object(ce.a)({},e,{isLoading:!1,accessToken:t.accessToken}):"LOGIN_FAILED"===n?Object(ce.a)({},e,{isLoading:!1}):"LOGOUT"===n?Object(ce.a)({},e,{accessToken:null}):e},stompReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"STOMP_CLIENT_CONNECTED":return Object(ce.a)({},e,{stompClient:t.stompClient,isConnected:!0});case"STOMP_CLIENT_DISCONNECTED":return Object(ce.a)({},e,{stompClient:null,isConnected:!1});default:return e}},chatReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue,t=arguments.length>1?arguments[1]:void 0,n=t.type;if("STOMP_CLIENT_WILL_DISCONNECT"===n)return ue;if("CHAT_MESSAGE"===n){var r=t.message,a=r.to,o=r.from;if("object"===typeof a&&null!==a){var c=Object.assign({},e.userMessages),s=a.user.id===e.me?o.user.id:a.user.id;return"undefined"===typeof c[s]&&(c[s]=[]),c[s].push(t.message),Object(ce.a)({},e,{userMessages:c})}var i=Object.assign({},e.roomMessages),u=e.currentRoom.id;return"undefined"===typeof i[u]&&(i[u]=[]),i[u].push(t.message),Object(ce.a)({},e,{roomMessages:i})}if("SELECTED_USER"===n)return Object(ce.a)({},e,{speakingTo:t.attendee});if("FETCHED_ME"===n)return Object(ce.a)({},e,{me:t.me});if("TOPIC_SUBSCRIBED"===n){if(t.topic.uri.startsWith("/app"))return e;var l=e.topics.slice();return l.push(t.topic),Object(ce.a)({},e,{topics:l})}if("TOPIC_UNSUBSCRIBED"===n){if(t.topic.uri.startsWith("/app"))return e;var m=e.topics.slice(),p=m.indexOf(t.topic);return p>=0&&m.splice(p,1),Object(ce.a)({},e,{topics:m})}if("ALL_ROOMS_FETCHED"===n)return Object(ce.a)({},e,{rooms:t.rooms});if("ROOM_DETAILS_FETCHED"===n)return Object(ce.a)({},e,{currentRoom:t.room});if("ROOM_CREATED"===n){var d=e.rooms.slice();return d.push(t.room),Object(ce.a)({},e,{rooms:d})}if("EXITED_ROOM"===n)return Object(ce.a)({},e,{currentRoom:null});if("USER_ENTERED"===n){if(null===e.currentRoom)return e;var f=Object.assign({},e.currentRoom);return f.attendees.push(t.attendee),Object(ce.a)({},e,{currentRoom:f})}if("USER_EXITED"===n){if(null==e.currentRoom)return e;var E=Object.assign({},e.currentRoom),O=E.attendees,h=O.indexOf(t.attendee);return E.attendees=O.splice(h,1),Object(ce.a)({},e,{currentRoom:E})}return e}}),me=n(22),pe=n(23),de=Object(oe.createStore)(le,Object(pe.composeWithDevTools)(Object(oe.applyMiddleware)(me.a,function(e){var t=e.getState,n=e.dispatch;return function(e){return function(r){console.log("subscription middleware trigered.");var a=t().stompReducer.stompClient,o=t().chatReducer.topics,c=r.type;if("TO_SUBSCRIBE_TOPIC"===c){var s=r.topic,i=r.handler;s.subscription=a.subscribe(s.uri,function(e){return i(n,e)}),n(R(s))}if("TO_UNSUBSCRIBE_TOPIC"===c){0===o.length&&e(r);var u=r.topicUri,l=o.filter(function(e){return e.uri===u})[0];console.log("To unsubscribe topic: "),console.log(l),l.subscription.unsubscribe(),n(N(l))}"TO_PUBLISH"===c&&a.publish(r.data),c===x&&(t().chatReducer.topics.forEach(function(e){return a.unsubscribe(e)}),a.deactivate(),n(U)),e(r)}}}))),fe=(n(57),function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return a.a.createElement(P.a,{store:de},a.a.createElement(ae,null))}}]),t}(r.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(fe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[24,2,1]]]);
//# sourceMappingURL=main.f3d9d80d.chunk.js.map